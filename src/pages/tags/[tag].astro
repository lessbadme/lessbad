---
import { getCollection } from "astro:content";
import HubLayout from "../../layouts/HubLayout.astro";
import EntryList from "../../components/EntryList.astro";

export async function getStaticPaths() {
  const entries = await getCollection("entries");
  const tags = [...new Set(entries.flatMap((entry) => entry.data.tags))];

  return tags.map((tag) => ({ params: { tag } }));
}

const { tag } = Astro.params;

const entries = (await getCollection(
  "entries",
  ({ data }) => tag !== undefined && data.tags.includes(tag),
)).sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
---

<HubLayout
  title={`Tag: ${tag}`}
  heading={`#${tag}`}
  intro="Cross-game notes grouped by topic."
>
  <section class="notebook-surface">
    <EntryList entries={entries} emptyMessage="No entries found for this tag." />
  </section>
</HubLayout>
