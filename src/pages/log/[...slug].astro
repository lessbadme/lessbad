---
import { getCollection, getEntry } from "astro:content";
import HubLayout from "../../layouts/HubLayout.astro";
import TagList from "../../components/TagList.astro";
import GameBadge from "../../components/GameBadge.astro";

export async function getStaticPaths() {
  const entries = await getCollection("entries");

  return entries.map((entry) => ({ params: { slug: entry.slug } }));
}

const slugParam = Astro.params.slug;
const slug = Array.isArray(slugParam) ? slugParam.join("/") : slugParam ?? "";

const entry = await getEntry("entries", slug);

if (!entry) {
  throw new Error(`Entry not found: ${slug}`);
}

const { Content } = await entry.render();
---

<HubLayout
  title={entry.data.title}
  heading={entry.data.title}
  intro={entry.data.summary}
>
  <div class="notebook-surface stack">
    <div class="meta-row">
      <GameBadge game={entry.data.game} />
      <span class="muted">{entry.data.date.toISOString().slice(0, 10)}</span>
      <span class="muted">Â· {entry.data.status}</span>
    </div>
    <TagList tags={entry.data.tags} />

    <article class="card" data-game={entry.data.game}>
      <Content />
    </article>
  </div>
</HubLayout>
